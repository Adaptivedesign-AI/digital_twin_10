{% extends "base.html" %}

{% block title %}Generative Digital Adolescent Cohort{% endblock %}

{% block content %}
<div class="container">
    <!-- 页面头部 -->
    <div class="page-header">
        <div class="title-container">
            <div class="brain-icon">🧠</div>
            <h1 class="page-title">Generative Digital Adolescent Cohort</h1>
        </div>
        <h2 class="page-subtitle">Choose a digital adolescent to chat with</h2>
        <p class="page-description">
            These digital adolescents are AI-powered digital twins of real-world teens, designed to enable data-driven 
            simulations of risk trajectories and intervention outcomes. The platform is developed and maintained by the 
            UC Berkeley team. For inquiries or questions, please contact 
            <a href="mailto:jingshenwang@berkeley.edu">jingshenwang@berkeley.edu</a>.
        </p>
    </div>

    <!-- 角色网格 -->
    <div class="character-grid">
        {% for character in characters %}
        <div class="character-card" data-student-id="{{ character.id }}">
            <div class="avatar-container">
                <img src="{{ url_for('static', filename='images/' + character.avatar) }}" 
                     alt="{{ character.name }}"
                     onerror="this.src='{{ url_for('static', filename='images/default_avatar.png') }}'">
            </div>
            <div class="character-info">
                <h3 class="student-name">{{ character.name }}</h3>
                <p class="student-description">{{ character.description }}</p>
            </div>
            <button class="chat-btn" onclick="selectStudent('{{ character.id }}')">
                Start Chat
            </button>
        </div>
        {% endfor %}
    </div>
</div>

<!-- 加载动画 -->
<div id="loading-overlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading chat interface...</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function selectStudent(studentId) {
    // 显示加载动画
    document.getElementById('loading-overlay').style.display = 'flex';
    
    // 添加选择效果
    document.querySelectorAll('.character-card').forEach(card => {
        card.classList.remove('selected');
    });
    document.querySelector(`[data-student-id="${studentId}"]`).classList.add('selected');
    
    // 延迟跳转以显示选择效果
    setTimeout(() => {
        window.location.href = `/chat/${studentId}`;
    }, 500);
}

// 添加卡片点击效果
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.character-card').forEach(card => {
        card.addEventListener('click', function(e) {
            if (!e.target.classList.contains('chat-btn')) {
                const studentId = this.dataset.studentId;
                selectStudent(studentId);
            }
        });
        
        // 添加悬停效果
        card.addEventListener('mouseenter', function() {
            this.classList.add('hover');
        });
        
        card.addEventListener('mouseleave', function() {
            this.classList.remove('hover');
        });
    });
});
</script>
{% endblock %}